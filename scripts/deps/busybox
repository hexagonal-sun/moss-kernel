#!/usr/bin/env bash
set -euo pipefail

ARCH="${TARGET_ARCH:-$(uname -m)}"

pushd "build" &>/dev/null || exit 1

if [ "$ARCH" == 'aarch64' ]; then
    BUSYBOX_FILE="busybox-aarch64-linux-gnu"
elif [ "$ARCH" == 'x86_64' ]; then
    BUSYBOX_FILE="busybox-x86_64-linux-gnu"
else
    echo "Unsupported architecture: $ARCH"
    exit 1
fi

wget https://github.com/shutingrz/busybox-static-binaries-fat/raw/refs/heads/main/"$BUSYBOX_FILE"
chmod +x "$BUSYBOX_FILE"
mv "$BUSYBOX_FILE" bin/busybox

popd &>/dev/null || exit 1
